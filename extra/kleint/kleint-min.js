/*! Klient v0.1-alpha */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.KConnector=t():e.KConnector=t()}(self,(()=>(()=>{"use strict";var e={m:{},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},u:e=>e+".kleint-min.js"};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&(t=n.currentScript.src),!t)){var o=n.getElementsByTagName("script");if(o.length)for(var r=o.length-1;r>-1&&(!t||!/^http(s?):/.test(t));)t=o[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),e.b=document.baseURI||self.location.href;var t={};e.d(t,{default:()=>u});var n={none:0,error:1,warn:2,info:3,debug:4,trace:5},o=function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},r=function(e,t,n){if(n||2===arguments.length)for(var o,r=0,a=t.length;r<a;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},a=function(){function e(e){void 0===e&&(e="debug"),this.level=n[e]}return e.getInstance=function(t){return e.instance&&e.instance.level===n[t]||(e.instance=new e(t)),e.instance},e.prototype.log=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];n[e]<=this.level&&console.log.apply(console,t)},e.instance=null,e}();function i(e,t){var n=function(e,t,n){if(!function(e){return/(?:https?|vpod):\/\/(\w+:?\w*)?(\S+)(:\d+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/.test(e)}(e))throw new Error("[Kleint-Connector] URL is not valid: "+e);var o=new URL(e),a=o.protocol.slice(0,-1);"vpod"===a&&(e=e.replace("vpod://","http://"),o=new URL(e));var i=o.hostname,s=(o.pathname.startsWith("/")?o.pathname.slice(1):o.pathname).split("/"),c=s.splice(0,1)[0],l=Array.from(o.searchParams.keys()).map((function(e){return"".concat(e,"=").concat(o.searchParams.get(e))}));return l=r(r([],l,!0),s.map((function(e,t){return"".concat(t,"=").concat(e)})),!0),t&&l.push("requestId=".concat(t)),n&&l.push("sessionId=".concat(n)),{protocol:a,destination:i,path:c,params:l}}(e.Url),a=n.protocol,i=n.destination,s=n.path,c=n.params;return o(o({},e),{RequestId:e.RequestId,SessionId:t,Protocol:a,Destination:i,Path:s,Params:c})}var s,c=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{c(o.next(e))}catch(e){a(e)}}function s(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((o=o.apply(e,t||[])).next())}))},l=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};const u=function(){function t(t){void 0===t&&(t={}),this.callbacks={},this.mainWorker=new Worker(new URL(e.p+e.u(574),e.b)),this.mainWorker.onmessage=this.handleMessage.bind(this),this.callbacks=t}return t.prototype.init=function(e,t,n){void 0===n&&(n="trace"),s=a.getInstance(n),this.mainWorker.postMessage({Type:"init",GatewayURL:e,SessionName:t,Debug:n})},t.prototype.sendData=function(e){s.log("trace","[Kleint-Connector] Sending message to VPod"),e.RequestId=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",o=0;o<e;o++){var r=Math.floor(62*Math.random());n+=t.charAt(r)}return n}(10);var t=i(e,"");this.mainWorker.postMessage({Type:"httpRequest",Message:t})},t.prototype.close=function(){s.log("debug","[Kleint-Connector] Closing WebSocket connection"),this.mainWorker.postMessage({Type:"close"})},t.prototype.handleMessage=function(e){return c(this,void 0,void 0,(function(){var t,n,o,r;return l(this,(function(a){switch(a.label){case 0:return s.log("trace","[Kleint-Connector] Message sent to the main thread:",e.data),t=e.data.Message,n=t.Path,this.callbacks.hasOwnProperty(n)?[4,this.callbacks[n](t)]:[3,2];case 1:o=a.sent(),r={Body:o,Destination:t.Sender,RequestId:t.RequestId,SessionId:t.SessionId,Sender:"main",StatusCode:200},this.mainWorker.postMessage({Type:"httpResponse",Message:r}),a.label=2;case 2:return[2]}}))}))},t}();return t=t.default})()));